name: Simple TimeTree Sync

on:
  schedule:
    # 毎朝6:00 JST (21:00 UTC前日) に実行
    - cron: '0 21 * * *'
  
  workflow_dispatch:
    inputs:
      test_mode:
        description: 'Run in test mode (no actual notifications)'
        required: false
        default: 'true'

jobs:
  simple-sync:
    name: Simple TimeTree to LINE Notification
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install Simple Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r simple_requirements.txt
      
      - name: Install Playwright Browsers
        run: |
          playwright install chromium
          playwright install-deps
      
      - name: Run Simple TimeTree Notifier
        env:
          TIMETREE_EMAIL: ${{ secrets.TIMETREE_EMAIL }}
          TIMETREE_PASSWORD: ${{ secrets.TIMETREE_PASSWORD }}
          TIMETREE_CALENDAR_CODE: ${{ secrets.TIMETREE_CALENDAR_CODE }}
          LINE_CHANNEL_ACCESS_TOKEN: ${{ secrets.LINE_CHANNEL_ACCESS_TOKEN }}
          LINE_USER_ID: ${{ secrets.LINE_USER_ID }}
          TEST_MODE: ${{ github.event.inputs.test_mode || 'true' }}
        run: |
          echo "🚀 Simple TimeTree Notifier 実行開始"
          python simple_timetree_notifier.py
          
          if [ $? -eq 0 ]; then
            echo "✅ Simple TimeTree Notifier 実行成功"
          else
            echo "❌ Simple TimeTree Notifier 実行失敗"
            exit 1
          fi